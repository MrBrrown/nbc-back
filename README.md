# NeoBitCloud Backend

Этот проект представляет собой backend часть проекта NeoBitCloud.

## Используемые технологии

- **FastAPI:** Современный, быстрый веб-фреймворк для построения API.
- **PostgreSQL:** Мощная система управления базами данных.
- **Docker:** Платформа для контейнеризации приложений.
- **Docker Compose:** Инструмент для управления многоконтейнерными приложениями.
- **asyncpg:** Асинхронный драйвер для PostgreSQL (или psycopg2).
- **Pydantic:** Библиотека для валидации данных и управления настройками.

## Требования

- Docker Desktop: [https://www.docker.com/products/docker-desktop](https://www.docker.com/products/docker-desktop)
- Python 3.13.1+: [https://www.python.org/downloads/](https://www.python.org/downloads/)
- Microsoft Visual C++ 14.0 или выше (для Windows): [https://aka.ms/vs/17/release/vc_redist.x64.exe](https://aka.ms/vs/17/release/vc_redist.x64.exe)
- Chocolatey (для Windows): [https://chocolatey.org/install](https://chocolatey.org/install)
- Make (для Windows): Устанавливается через Chocolatey

## Установка и запуск

1. **Установка Docker Desktop:** Установите и запустите Docker Desktop.
2. **Дополнительные шаги для Windows:**

   * **Установка зависимости для asyncpg/psycopg2:**  Установите "Microsoft Visual C++ 14.0 или выше".  Это необходимо для корректной работы  `asyncpg` (или `psycopg2`, если используется).

   * **Установка Make:** Если у вас не установлен Make, установите [Chocolatey](https://community.chocolatey.org/install.ps1), а затем выполните в PowerShell от имени администратора:
     ```powershell
     choco install make
     ```

3. **Запуск приложения (после запуска контейнеров):**
   ```bash
   make setup
   ```

## Структура проекта
**Краткое описание:**

*   **alembic:** Управление миграциями базы данных.
*   **app:** Исходный код основного приложения.
    *   **api:** Реализация API (endpoints).
    *   **clients:** Взаимодействие с внешними сервисами.
    *   **core:** Базовые утилиты и конфигурация.
    *   **models:** Описание моделей данных.
    *   **repositories:** Взаимодействие с базой данных.
    *   **schemas:** Валидация данных с помощью Pydantic.
    *   **services:** Бизнес-логика приложения.
*   **tests:** Тесты (юнит-тесты и интеграционные тесты).

**Подробное описание:**
```
nbc-back/
├── alembic/ # Миграции базы данных Alembic
│ ├── env.py # Скрипт настройки окружения для Alembic. Определяет, как Alembic подключается к базе данных и как обрабатываются миграции.
│ ├── README # Файл с описанием как использовать Alembic в проекте.
│ ├── script.py.mako # Шаблон для генерации новых миграций.
│ └── versions/ # Директория с файлами миграций.
│ └── 9e5090c48942_initial_schema_sync.py # Пример файла миграции. Содержит код для применения и отката изменений в базе данных.
├── app/ # Основной код приложения
│ ├── api/ # API endpoints (точки входа для взаимодействия с приложением)
│ │ ├── v1/ # Версия API v1
│ │ │ ├── endpoints/ # Модули, определяющие конечные точки API
│ │ │ │ ├── init.py # Инициализационный файл, может содержать общую логику для endpoints.
│ │ │ │ ├── buckets_api.py # Конечные точки для работы с бакетами (buckets).
│ │ │ │ ├── misc_api.py # Конечные точки для различных вспомогательных операций.
│ │ │ │ ├── objects_api.py # Конечные точки для работы с объектами (objects).
│ │ │ │ ├── routes.py # Файл, объединяющий все routes (маршруты) для API v1.
│ │ │ │ └── users_api.py # Конечные точки для работы с пользователями (users).
│ │ │ └── init.py # Инициализационный файл для API v1.
│ │ └── init.py # Инициализационный файл для модуля api.
│ ├── clients/ # Клиенты для взаимодействия с внешними сервисами (например, S3, базы данных, другие API)
│ │ └── init.py # Инициализационный файл для модуля clients.
│ ├── core/ # Основные настройки, утилиты и вспомогательные модули
│ │ ├── config.py # Модуль с конфигурацией приложения (настройки подключения к БД, параметры логирования и т.д.).
│ │ ├── logging.py # Модуль для настройки логирования.
│ │ ├── metrics.py # Модуль для сбора и обработки метрик приложения.
│ │ └── security.py # Модуль, содержащий функции, связанные с безопасностью (хеширование паролей, генерация токенов и т.д.).
│ ├── models/ # Модели базы данных (описание таблиц и их полей).
│ │ ├── init.py # Инициализационный файл для модуля models.
│ │ ├── BaseModel.py # Базовый класс для всех моделей. Может содержать общие поля или методы.
│ │ ├── bucket.py # Модель для сущности "bucket".
│ │ ├── object.py # Модель для сущности "object".
│ │ └── user.py # Модель для сущности "user".
│ ├── repositories/ # Репозитории (классы для работы с данными в БД).
│ │ └── init.py # Инициализационный файл для модуля repositories.
│ ├── schemas/ # Pydantic схемы (описание структур данных для валидации).
│ │ ├── init.py # Инициализационный файл для модуля schemas.
│ │ └── bucket.py # Схема для валидации данных, относящихся к сущности "bucket".
│ ├── services/ # Сервисы (бизнес-логика приложения).
│ │ ├── init.py # Инициализационный файл для модуля services.
│ │ ├── bucket_service.py # Сервис, содержащий бизнес-логику для работы с бакетами.
│ │ ├── object_service.py # Сервис, содержащий бизнес-логику для работы с объектами.
│ │ └── user_service.py # Сервис, содержащий бизнес-логику для работы с пользователями.
│ ├── init.py # Инициализационный файл для модуля app.
│ ├── app.py # Основной файл приложения, где создается экземпляр FastAPI приложения и подключаются роутеры.
│ ├── db.py # Модуль для работы с базой данных (подключение, сессии).
│ ├── Dockerfile # Инструкции для сборки Docker-образа приложения.
│ ├── entrypoint.sh # Скрипт, запускаемый при старте Docker-контейнера.
│ ├── enums.py # Перечисления (enumerations), используемые в приложении.
│ ├── exceptions.py # Пользовательские исключения, специфичные для данного приложения.
│ └── main.py # Точка входа в приложение (запуск uvicorn).
├── tests/ # Тесты
│ ├── integration/ # Интеграционные тесты (проверяют взаимодействие между различными модулями приложения)
│ │ ├── init.py
│ │ ├── test_file_operations.py # Интеграционные тесты для операций с файлами.
│ │ └── test_user_operations.py # Интеграционные тесты для операций с пользователями.
│ ├── unit/ # Юнит-тесты (проверяют отдельные модули и функции в изоляции)
│ │ ├── init.py
│ │ ├── test_files.py # Юнит-тесты для модуля, связанного с файлами.
│ │ └── test_users.py # Юнит-тесты для модуля, связанного с пользователями.
│ └── init.py # Инициализационный файл для модуля tests.
├── .coveragerc # Файл конфигурации для coverage.py (инструмент для измерения покрытия кода тестами).
├── .gitignore # Список файлов и директорий, которые Git должен игнорировать.
├── alembic.ini # Файл конфигурации для Alembic.
├── cli.py # Скрипт для запуска команд из командной строки (Command Line Interface).
├── docker-compose.yaml # Файл конфигурации Docker Compose для запуска приложения и его зависимостей в контейнерах.
├── makefile # Файл с инструкциями для утилиты make (автоматизация сборки, запуска тестов и т.д.).
├── mypy.ini # Файл конфигурации для mypy (статический анализатор типов).
├── poetry.lock # Файл, содержащий зафиксированные версии зависимостей проекта (генерируется Poetry).
├── pyproject.toml # Файл конфигурации проекта, используемый Poetry и другими инструментами.
├── README.md # Этот файл (описание проекта).
└── settings.toml # Файл конфигурации для настроек приложения в формате TOML.
```

## Лицензия

Этот проект лицензирован под лицензией MIT.